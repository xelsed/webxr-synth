<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebXR Audio Synthesizer</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    #app {
      width: 100vw;
      height: 100vh;
      position: relative;
    }
    
    #info {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      background: rgba(0, 0, 0, 0.5);
      padding: 10px;
      border-radius: 5px;
      font-size: 14px;
      z-index: 100;
    }
    
    #controls {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      z-index: 100;
    }
    
    button {
      padding: 10px 20px;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 25px;
      cursor: pointer;
      backdrop-filter: blur(10px);
      transition: all 0.3s;
      font-size: 14px;
      font-weight: bold;
    }
    
    button:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(1.05);
    }
    
    button:active {
      transform: scale(0.95);
    }
    
    #loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 24px;
      text-align: center;
    }
    
    .pulse {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
  </style>
</head>
<body>
  <div id="app">
    <div id="info">
      <div>WebXR Audio Synthesizer</div>
      <div>FPS: <span id="fps">60</span></div>
      <div>Status: <span id="status">Ready</span></div>
    </div>
    
    <div id="loading" class="pulse">Initializing...</div>
    
    <div id="controls" style="display: none;">
      <button id="play-button">Play</button>
      <button id="mode-button">Change Mode</button>
      <button id="reset-button">Reset</button>
    </div>
  </div>
  
  <script type="module">
    // Import from CDN to avoid build issues
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.170.0/build/three.module.js';
    import * as Tone from 'https://cdn.jsdelivr.net/npm/tone@15.0.4/build/Tone.js';
    
    class SimpleWebXRSynth {
      constructor() {
        this.scene = null;
        this.camera = null;
        this.renderer = null;
        this.orb = null;
        this.particles = [];
        this.synth = null;
        this.isPlaying = false;
        this.clock = new THREE.Clock();
        
        this.init();
      }
      
      async init() {
        try {
          console.log('Initializing...');
          
          // Setup Three.js
          this.setupScene();
          this.createOrb();
          this.createParticles();
          
          // Setup events
          this.setupEvents();
          
          // Hide loading, show controls
          document.getElementById('loading').style.display = 'none';
          document.getElementById('controls').style.display = 'flex';
          document.getElementById('status').textContent = 'Ready';
          
          // Start animation
          this.animate();
          
        } catch (error) {
          console.error('Init error:', error);
          document.getElementById('loading').textContent = 'Error: ' + error.message;
        }
      }
      
      setupScene() {
        // Scene
        this.scene = new THREE.Scene();
        this.scene.fog = new THREE.Fog(0x000033, 5, 50);
        
        // Camera
        this.camera = new THREE.PerspectiveCamera(
          75,
          window.innerWidth / window.innerHeight,
          0.1,
          1000
        );
        this.camera.position.set(0, 2, 5);
        this.camera.lookAt(0, 0, 0);
        
        // Renderer
        this.renderer = new THREE.WebGLRenderer({ 
          antialias: true,
          alpha: true
        });
        this.renderer.setSize(window.innerWidth, window.innerHeight);
        this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        document.getElementById('app').appendChild(this.renderer.domElement);
        
        // Lights
        const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
        this.scene.add(ambientLight);
        
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
        directionalLight.position.set(5, 10, 5);
        this.scene.add(directionalLight);
        
        // Grid
        const gridHelper = new THREE.GridHelper(20, 20, 0x444444, 0x222222);
        this.scene.add(gridHelper);
      }
      
      createOrb() {
        const geometry = new THREE.IcosahedronGeometry(1, 2);
        const material = new THREE.MeshPhongMaterial({
          color: 0x00ffff,
          emissive: 0x00ffff,
          emissiveIntensity: 0.2,
          wireframe: true
        });
        
        this.orb = new THREE.Mesh(geometry, material);
        this.orb.position.y = 1;
        this.scene.add(this.orb);
        
        // Inner orb
        const innerGeometry = new THREE.SphereGeometry(0.8, 16, 16);
        const innerMaterial = new THREE.MeshBasicMaterial({
          color: 0xff00ff,
          transparent: true,
          opacity: 0.3
        });
        const innerOrb = new THREE.Mesh(innerGeometry, innerMaterial);
        this.orb.add(innerOrb);
      }
      
      createParticles() {
        const particleCount = 100;
        const geometry = new THREE.BufferGeometry();
        const positions = new Float32Array(particleCount * 3);
        
        for (let i = 0; i < particleCount * 3; i += 3) {
          const angle = Math.random() * Math.PI * 2;
          const radius = 2 + Math.random() * 3;
          
          positions[i] = Math.cos(angle) * radius;
          positions[i + 1] = Math.random() * 2;
          positions[i + 2] = Math.sin(angle) * radius;
        }
        
        geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        
        const material = new THREE.PointsMaterial({
          color: 0xffffff,
          size: 0.1,
          transparent: true,
          opacity: 0.6
        });
        
        const particles = new THREE.Points(geometry, material);
        this.scene.add(particles);
        this.particles = particles;
      }
      
      setupEvents() {
        // Play button
        document.getElementById('play-button').addEventListener('click', () => {
          this.toggleAudio();
        });
        
        // Mode button
        document.getElementById('mode-button').addEventListener('click', () => {
          const colors = [0x00ffff, 0xff00ff, 0xffff00, 0x00ff00];
          const color = colors[Math.floor(Math.random() * colors.length)];
          this.orb.material.color.setHex(color);
          this.orb.material.emissive.setHex(color);
        });
        
        // Reset button
        document.getElementById('reset-button').addEventListener('click', () => {
          this.reset();
        });
        
        // Window resize
        window.addEventListener('resize', () => {
          this.camera.aspect = window.innerWidth / window.innerHeight;
          this.camera.updateProjectionMatrix();
          this.renderer.setSize(window.innerWidth, window.innerHeight);
        });
      }
      
      async toggleAudio() {
        try {
          if (!this.isPlaying) {
            // Start audio
            document.getElementById('status').textContent = 'Starting audio...';
            
            if (!this.synth) {
              await Tone.start();
              this.synth = new Tone.Synth().toDestination();
            }
            
            // Simple pattern
            const notes = ['C4', 'E4', 'G4', 'C5'];
            let noteIndex = 0;
            
            this.pattern = new Tone.Loop((time) => {
              this.synth.triggerAttackRelease(notes[noteIndex], '8n', time);
              noteIndex = (noteIndex + 1) % notes.length;
            }, '8n');
            
            this.pattern.start(0);
            Tone.Transport.start();
            
            this.isPlaying = true;
            document.getElementById('play-button').textContent = 'Stop';
            document.getElementById('status').textContent = 'Playing';
            
          } else {
            // Stop audio
            if (this.pattern) {
              this.pattern.stop();
              Tone.Transport.stop();
            }
            
            this.isPlaying = false;
            document.getElementById('play-button').textContent = 'Play';
            document.getElementById('status').textContent = 'Stopped';
          }
        } catch (error) {
          console.error('Audio error:', error);
          document.getElementById('status').textContent = 'Audio error';
        }
      }
      
      reset() {
        if (this.isPlaying) {
          this.toggleAudio();
        }
        
        this.orb.material.color.setHex(0x00ffff);
        this.orb.material.emissive.setHex(0x00ffff);
        this.orb.scale.set(1, 1, 1);
        
        document.getElementById('status').textContent = 'Reset';
      }
      
      animate() {
        requestAnimationFrame(() => this.animate());
        
        const deltaTime = this.clock.getDelta();
        const elapsedTime = this.clock.getElapsedTime();
        
        // Rotate orb
        if (this.orb) {
          this.orb.rotation.y += deltaTime * 0.5;
          this.orb.rotation.x = Math.sin(elapsedTime * 0.3) * 0.1;
          
          // Pulse when playing
          if (this.isPlaying) {
            const scale = 1 + Math.sin(elapsedTime * 4) * 0.1;
            this.orb.scale.set(scale, scale, scale);
          }
        }
        
        // Rotate particles
        if (this.particles) {
          this.particles.rotation.y += deltaTime * 0.1;
        }
        
        // Update FPS
        const fps = Math.round(1 / deltaTime);
        document.getElementById('fps').textContent = fps;
        
        // Render
        this.renderer.render(this.scene, this.camera);
      }
    }
    
    // Start the app
    const app = new SimpleWebXRSynth();
  </script>
</body>
</html>